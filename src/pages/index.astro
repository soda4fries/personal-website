---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { defaultLanguage, useTranslations, type LanguageCode } from '@/i18n/ui';
import { getCollection } from 'astro:content';
import BlogHomeScreen from '@/features/blog/screens/BlogHomeScreen.astro';

const lang =
  (Astro.currentLocale as LanguageCode | undefined) ?? defaultLanguage;
const t = useTranslations(lang, 'homePage');

const pageTitle = t('pageTitle');
const pageDescription = t('pageDescription');

// Get featured blog posts
const allPosts = await getCollection('blog', ({ data, id }) => {
  return data.isDraft !== true && id.startsWith(`${defaultLanguage}/`);
});

const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const featuredPosts = sortedPosts.filter(post => post.data.featured).slice(0, 3);

// Skills data from the original projects service
const skills = [
  {
    title: "Frontend Development",
    description: "I am not expanding this skill tree since it moves too fast, and CSS is hard.",
    iconName: "MonitorSmartphone",
    technologies: [
      { id: "html5", name: "HTML" },
      { id: "css3", name: "CSS" },
      { id: "javascript", name: "JavaScript" },
      { id: "typescript", name: "TypeScript" }
    ]
  },
  {
    title: "Backend Development", 
    description: "I have experience with these backend technologies, and in general, I can weasel my way around most backend issues.",
    iconName: "ServerCog",
    technologies: [
      { id: "nodejs", name: "Node.js" },
      { id: "python", name: "Python" },
      { id: "postgresql", name: "PostgreSQL" },
      { id: "redis", name: "Redis" }
    ]
  },
  {
    title: "Machine Learning & AI",
    description: "Mostly self learned but have some peer reviewed publication, I would like to do more research in this field.",
    iconName: "Brain",
    technologies: [
      { id: "pytorch", name: "PyTorch" },
      { id: "huggingface", name: "Hugging Face" },
      { id: "python", name: "Python" },
      { id: "computervision", name: "Computer Vision" }
    ]
  },
  {
    title: "DevOps & Infrastructure",
    description: "Comfortable with setting up and managing infrastructure, CI/CD pipelines, and monitoring in production environments.",
    iconName: "Network",
    technologies: [
      { id: "docker", name: "Docker" },
      { id: "kubernetes", name: "Kubernetes" },
      { id: "git", name: "Git" },
      { id: "linux", name: "Linux" }
    ]
  }
];


const layoutProps = {
  lang,
  posts: featuredPosts,
  allPosts: sortedPosts, // Pass all posts for tag cloud
  skills,
  heroGreeting: t('heroGreeting'),
  heroSubtitlePart1: t('heroSubtitlePart1'),
  heroSubtitlePart2: t('heroSubtitlePart2'),
  heroIntroduction: t('heroIntroduction'),
  heroViewWorkButton: 'View My Blog',
  heroContactButton: t('heroContactButton'),
  featuredBlogsTitle: 'Latest Blog Posts',
  featuredBlogsDescription: 'Explore my latest thoughts on technology, development, and innovation.',
  mySkillsTitle: t('mySkillsTitle'),
  mySkillsDescription: t('mySkillsDescription'),
};
---

<BaseLayout pageTitle={pageTitle} pageDescription={pageDescription}>
  <BlogHomeScreen {...layoutProps} />
</BaseLayout>

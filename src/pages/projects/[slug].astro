---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProjectLayout from '@/features/projects/layouts/ProjectLayout.astro';
import { ui, type LanguageCode, defaultLanguage } from '@/i18n/ui';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects', ({ data }) => {
    return data.isDraft !== true;
  });
  
  return projects.map((project) => ({
    params: { slug: project.id },
    props: { project },
  }));
}

const { project } = Astro.props;
const lang = defaultLanguage as LanguageCode;
const t = ui[lang];

if (!project) {
  return Astro.redirect('/404');
}

const { Content } = await render(project);

const pageTitle = `${project.data.title} | ${t.site.title}`;
const pageDescription = project.data.description;
---

<BaseLayout pageTitle={pageTitle} pageDescription={pageDescription}>
  <ProjectLayout project={project.data} t={t} lang={lang}>
    <Content />
  </ProjectLayout>
</BaseLayout>
